/**
 * Router
 * Version: 0.0.1
 * Author: Dmitry Shimkin <dmitryshimkin@gmail.com>
 * License: MIT
 * https://github.com/dmitryshimkin/router
 */
!function(t){"use strict";function n(t,n){return e(n,function(n,e){t[e]=n}),t}function e(t,n,e){if("length"in t)for(var o=0,i=t.length;i>o;o++)n.call(e,t[o],o);else for(var s in t)t.hasOwnProperty(s)&&n.call(e,t[s],s);return t}function o(t){try{console.warn(t)}catch(n){}}function i(t,n){this.name=t,this.pattern=n}function s(t){n(this,t)}function u(t){this._queue.push(t),this._processing||f.call(this)}function r(t){return t?t.slice(1,t.length):[]}function c(t,n){for(var e=t.length;e--;)if(t[e].name===n)return t[e];return null}function h(t,n){return null!==c(t,n.name)}function a(t,n){var o=[];return e(t,function(t){var e=t.matches(n);e&&o.push({name:t.name,params:r(e)})}),o}function l(){var t=a(this.routes,this.location),n=this.context||null,o=[],i=[],u=[],r=[];e(this._activeRoutes,function(n){var e=c(t,n.name);e?(o.push(e),r.push(e)):u.push({name:n.name})}),e(t,function(t){h(o,t)||(o.push(t),i.push(t))}),this._activeRoutes=o,"function"==typeof this.onRoute&&(r.length&&this.onRoute.call(n,new s({type:"routechange",routes:r})),u.length&&this.onRoute.call(n,new s({type:"routeend",routes:u})),i.length&&this.onRoute.call(n,new s({type:"routestart",routes:i})))}function f(){var t=this._queue.shift();t&&(this._processing=!0,this.location=t,l.call(this),this._queue.length&&f.call(this),this._processing=!1)}function p(){this._queue=[],this._processing=!1,this._activeRoutes=[],this.location="",this.routes={}}i.prototype.matches=function(t){return t.match(this.pattern)},p.prototype.addRoute=function(t,n){this.routes[t]?o("Route `"+t+"` is already added"):this.routes[t]=new i(t,n)},p.prototype.getLocation=function(){return this.location},p.prototype.setLocation=function(t){t!==this.location&&u.call(this,t)},"function"==typeof define&&define.amd?define("Router",p):"object"==typeof exports?module.exports=p:t.Router=p}(this);