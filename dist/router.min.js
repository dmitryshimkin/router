/**
 * Router
 * Version: 0.0.1
 * Author: Dmitry Shimkin <dmitryshimkin@gmail.com>
 * License: MIT
 * https://github.com/dmitryshimkin/router
 */
!function(t){"use strict";function e(t){function e(){}if(R)return Object.create(t);e.prototype=t;var n=new e;return e.prototype=null,n}function n(t,e){return o(e,function(e,n){t[n]=e}),t}function o(t,e,n){if("length"in t)for(var o=0,r=t.length;r>o;o++)e.call(n,t[o],o);else for(var u in t)t.hasOwnProperty(u)&&e.call(n,t[u],u);return t}function r(t){return"function"==typeof t}function u(t){try{console.warn(t)}catch(e){}}function i(t,e){this.name=t,this.pattern=e}function c(t){n(this,t)}function a(t,e,n){if(n.redirectCount>m.MAX_REDIRECT_COUNT)throw n.redirectCount=0,Error("Too many redirects");n.queue.push(t),n.isProcessing||d(e,n)}function s(t){return t?t.slice(1,t.length):[]}function f(t,e){for(var n=t.length;n--;)if(t[n].name===e)return t[n];return null}function l(t,e){return null!==f(t,e.name)}function h(t,e){var n=[];return o(t,function(t){var o=t.matches(e);o&&n.push({name:t.name,params:s(o)})}),n}function p(t,e){var n=h(e.routes,e.location),u=e.context||null,i=[],a=[],s=[],p=[];o(e.activeRoutes,function(t){var e=f(n,t.name);e?(i.push(e),p.push(e)):s.push({name:t.name})}),o(n,function(t){l(i,t)||(i.push(t),a.push(t))}),e.activeRoutes=i,r(t.onRoute)&&(p.length&&t.onRoute.call(u,new c({type:"routechange",routes:p})),s.length&&t.onRoute.call(u,new c({type:"routeend",routes:s})),a.length&&t.onRoute.call(u,new c({type:"routestart",routes:a})))}function d(t,e){var n=e.queue[0];n&&(e.redirectCount++,e.isProcessing=!0,e.location=n,p(t,e),e.queue.shift(),e.queue.length&&d(t,e),e.isProcessing=!1,e.redirectCount--)}function m(){function t(t,e){c.routes[t]?u("Route `"+t+"` is already added"):c.routes[t]=new i(t,e)}function n(){return c.location}function o(t){t!==c.location&&a(t,r,c)}var r=e(m.prototype),c={queue:[],isProcessing:!1,activeRoutes:[],location:"",redirectCount:0,routes:{}};return r.addRoute=t,r.getLocation=n,r.setLocation=o,r}var R=r(Object.create);i.prototype.matches=function(t){return t.match(this.pattern)},m.MAX_REDIRECT_COUNT=10,"function"==typeof define&&define.amd?define("Router",m):"object"==typeof exports?module.exports=m:t.Router=m}(this);